---
interface Props {
	categories?: Array<{
		id: string;
		label: string;
	}>;
}

const { categories = [
	{ id: 'videojuegos', label: 'Videojuegos' },
	{ id: 'modelos3d', label: 'Modelos 3D' },
	{ id: 'ilustraciones', label: 'Ilustraciones' },
	{ id: 'cv', label: 'CV' },
] } = Astro.props;

const icons: Record<string, string> = {
	videojuegos: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>',
	modelos3d: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',
	ilustraciones: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.71 4.63l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41zM7 14a3 3 0 00-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2a4 4 0 004-4 3 3 0 00-3-3z"/></svg>',
	cv: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>',
};
---

<header class="floating-header" id="floating-header">
	<nav class="nav-container">
		{categories.map((category) => (
			<a 
				href={`#${category.id}`} 
				class="nav-item" 
				data-section={category.id}
			>
				<span class="nav-icon" set:html={icons[category.id]} />
				<span class="nav-label">{category.label}</span>
			</a>
		))}
	</nav>
</header>

<style>
	.floating-header {
		position: fixed;
		top: var(--spacing-xl);
		left: 50%;
		transform: translateX(-50%) translateY(-100px);
		z-index: 1000;
		opacity: 0;
		visibility: hidden;
		transition: 
			transform var(--transition-normal),
			opacity var(--transition-normal),
			visibility var(--transition-normal);
	}

	.floating-header.visible {
		transform: translateX(-50%) translateY(0);
		opacity: 1;
		visibility: visible;
	}

	.nav-container {
		display: flex;
		gap: var(--spacing-xs);
		background: #2563eb;
		border-radius: 50px;
		padding: var(--spacing-sm) var(--spacing-md);
		box-shadow: 0 8px 32px rgba(37, 99, 235, 0.35);
	}

	.nav-item {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
		padding: var(--spacing-sm) var(--spacing-lg);
		border-radius: 25px;
		color: rgba(255, 255, 255, 0.8);
		font-size: 0.875rem;
		font-weight: 600;
		position: relative;
		transition: 
			color var(--transition-fast),
			background-color var(--transition-fast),
			transform var(--transition-fast);
	}

	.nav-item:hover {
		color: #ffffff;
		background: rgba(255, 255, 255, 0.15);
		transform: scale(1.02);
	}

	.nav-item.active {
		color: #2563eb;
		background: #ffffff;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	}

	.nav-item.active .nav-indicator {
		opacity: 1;
		transform: scaleX(1);
	}

	.nav-icon {
		width: 18px;
		height: 18px;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.nav-icon :global(svg) {
		width: 100%;
		height: 100%;
	}

	.nav-label {
		white-space: nowrap;
	}

	.nav-indicator {
		display: none;
	}

	/* Responsive */
	@media (max-width: 768px) {
		.floating-header {
			top: var(--spacing-md);
			left: var(--spacing-md);
			right: var(--spacing-md);
			transform: translateX(0) translateY(-100px);
		}

		.floating-header.visible {
			transform: translateX(0) translateY(0);
		}

		.nav-container {
			width: 100%;
			justify-content: space-around;
		}

		.nav-item {
			flex-direction: column;
			padding: var(--spacing-sm);
			gap: var(--spacing-xs);
		}

		.nav-label {
			font-size: 0.7rem;
		}
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const header = document.getElementById('floating-header');
		const navItems = document.querySelectorAll('.nav-item');
		const categoriesSection = document.getElementById('categories');
		
		// Sections to track
		const sections = ['videojuegos', 'modelos3d', 'ilustraciones', 'cv'];
		
		// Show/hide header based on scroll position
		const observerOptions = {
			root: null,
			rootMargin: '-10% 0px -10% 0px',
			threshold: 0
		};

		// Observer to show header when categories section is visible
		const headerVisibilityObserver = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					header?.classList.add('visible');
				}
			});
		}, { threshold: 0.1 });

		// Also check if we're past categories section
		const checkHeaderVisibility = () => {
			const categoriesRect = categoriesSection?.getBoundingClientRect();
			if (categoriesRect && categoriesRect.top < window.innerHeight * 0.5) {
				header?.classList.add('visible');
			} else {
				header?.classList.remove('visible');
			}
		};

		if (categoriesSection) {
			headerVisibilityObserver.observe(categoriesSection);
		}

		window.addEventListener('scroll', checkHeaderVisibility, { passive: true });

		// Highlight active section
		const sectionObserver = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					const sectionId = entry.target.id;
					navItems.forEach(item => {
						item.classList.remove('active');
						if (item.getAttribute('data-section') === sectionId) {
							item.classList.add('active');
						}
					});
				}
			});
		}, {
			root: null,
			rootMargin: '-40% 0px -40% 0px',
			threshold: 0
		});

		// Observe all category sections
		sections.forEach(sectionId => {
			const section = document.getElementById(sectionId);
			if (section) {
				sectionObserver.observe(section);
			}
		});

		// Smooth scroll on click
		navItems.forEach(item => {
			item.addEventListener('click', (e) => {
				e.preventDefault();
				const targetId = item.getAttribute('data-section');
				const targetSection = document.getElementById(targetId || '');
				if (targetSection) {
					targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
				}
			});
		});
	});
</script>
